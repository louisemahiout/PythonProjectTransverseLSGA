import pygame
import time

# Initialisation de Pygame
pygame.init()

# Définition des constantes
LARGEUR, HAUTEUR = 800, 600
BLANC = (255, 255, 255)
ROUGE = (255, 0, 0)
BLEU = (0, 0, 255)

# Création de la fenêtre
fenetre = pygame.display.set_mode((LARGEUR, HAUTEUR))
pygame.display.set_caption("Déplacement du personnage")

# Définition des personnages (joueur et bot)
personnage = pygame.Rect(200, 500, 50, 60)
bot = pygame.Rect(400, 575, 40, 30)

# Variables de mouvement
gravite = 0.8
saut_force = -10
y_momentum = 0
au_sol = False

# Vitesses
personnage_speed = 7
bot_speed = 3

# Système de vies et d'invincibilité
vies = 3
invincible = False
invincible_time = 0

# Boucle principale
running = True
while running:
    pygame.time.delay(30)

    # Gestion des événements
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            running = False

    # Vérification de l'invincibilité
    if invincible and time.time() - invincible_time >= 3:
        invincible = False  # Fin de l'invincibilité

    # Gestion des touches
    touches = pygame.key.get_pressed()
    if touches[pygame.K_LEFT] and personnage.x > 0:
        personnage_temp = personnage.move(-personnage_speed, 0)
        if not personnage_temp.colliderect(bot):
            personnage.x -= personnage_speed
    if touches[pygame.K_RIGHT] and personnage.x < LARGEUR - personnage.width:
        personnage_temp = personnage.move(personnage_speed, 0)
        if not personnage_temp.colliderect(bot):
            personnage.x += personnage_speed
    if touches[pygame.K_UP] and au_sol:
        y_momentum = saut_force
        au_sol = False

    # Application de la gravité
    y_momentum += gravite
    personnage.y += y_momentum

    if personnage.colliderect(bot) and not invincible:  # Collision avec le bot
        vies -= 1
        invincible = True
        invincible_time = time.time()
        print(f"Collision ! Vies restantes : {vies}")
        if vies <= 0:
            print("Game Over!")
            running = False

    # Empêcher le personnage de tomber sous le sol
    if personnage.y >= HAUTEUR - personnage.height:
        personnage.y = HAUTEUR - personnage.height
        au_sol = True
        y_momentum = 0

    # Calcul de la distance bot-joueur
    distance_x = abs(bot.x - personnage.x)

    # Si le bot est à 200 pixels ou moins, il suit le joueur
    if distance_x <= 200:
        if bot.x < personnage.x:
            bot_temp = bot.move(bot_speed, 0)
            if not bot_temp.colliderect(personnage):
                bot.x += bot_speed
        elif bot.x > personnage.x:
            bot_temp = bot.move(-bot_speed, 0)
            if not bot_temp.colliderect(personnage):
                bot.x -= bot_speed

    # Dessin des éléments
    fenetre.fill(BLANC)
    pygame.draw.rect(fenetre, ROUGE if not invincible else (255, 165, 0), personnage)  # Devient orange si invincible
    pygame.draw.rect(fenetre, BLEU, bot)
    pygame.display.update()

pygame.quit()

